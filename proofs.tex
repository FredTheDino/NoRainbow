\documentclass{book}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Imports
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage[backend=biber,sorting=none,hyperref]{biblatex}
\usepackage{mathtools}
\usepackage{dsfont}
\usepackage{tikz}
\usetikzlibrary{topaths,calc,tikzmark}
\usepackage{algorithm2e}
\usepackage{svg}
\usepackage{listings}
\usepackage{adjustbox}
\usepackage{forest}
\usetikzlibrary{er}

\pagestyle{empty}

\title{A Faster Algorithm for the No-Rainbow Problem}
\author{Edvard Th√∂rnros}
\date{2023-01-15}

\begin{document}

\maketitle

\tableofcontents



% TODO: Define the norainbow problem
% TODO: Show and explain the previous algorithm
% TODO: Write an introduction

\chapter{The No-Rainbow Problem}
TBA

\chapter{The Current Fastest Algorithm for the No-Rainbow problem}
TBA

\chapter{Definitions}
Definitions of simple concepts are defined in this chapter, these simple concepts are then built on in the final algorithm. These definitions could be understood separately to make the work as clear and easy to follow as possible.

\section{Notation}
\begin{itemize}
  \item $V(G)$ -- The set of nodes in the graph $G$ 
  \item $|V(G)|$ -- The number of nodes in the graph $G$ 
  \item $a!$ -- The faculty of $a$, $\Pi_{x=1}^a(x)$, the product of all natural numbers including $a$
\end{itemize}

\section{Color}
This paper will usually define a color with a letter early in the alphabet (e.g. $a$, $b$ or $c$). But the only important property of colors for the no-rainbow problem is equality, we only care if two colors are the same or not. For the no-rainbow problem there are $r$ distinct colors and all have to be present so the coloring is surjective.

The color that is the smallest is considered the 0-zero. In the case of letters $a$ is the zero colors since it's smaller than all other colors.

\section{Coloring}
Each coloring of a graph can be thought of as a string of colors where the index of each color-symbol is bound to one node - these are called colorings.

Each vertex is mapped to a unique integer in $[0, |V(G)|)$, this can then be used to create a mapping for each node to a color. In mathematical terms $\forall \quad x, y \in V(G), \quad i(x), i(y) \in [0, |V(G)|) \quad x = y \iff i(x) = i(y)$, two vertices are the same if they share the same index and vice versa, this creates a mapping from vertices to indices. Note that this mapping can be arbitrary, and one way of generating the mapping is by randomly placing each vertex a list and using the index into that list. The most important property is that this mapping is stable.

We can now define a coloring as a sequence of colors of length $|V(G)|$. For a graph with 5 nodes the coloring $abcde$ would color all of the nodes differently. This format is pretty terse and has some other nice properties. This format of colorings hides the secrets to speed up.

\section{Surjective}
A coloring is considered surjective if all colors are present. Consider that we have 3 colors $a$, $b$ and $c$. The coloring $aaa$ is not surjective, since it lacks $b$ and $c$. The coloring $abc$ is surjective since it has all 3 colors present. In the context of the no-rainbow problem a coloring is surjective if it has $r$ distinct colors present.

\section{Equivalent Colorings}
Since the no-rainbow problem only care about the equality of colors we can use a sub-set of all available colorings of a graph. Consider the colorings $aaa$ and $bbb$. We can create a mapping from color to color and change the first coloring ($aaa$) into the second coloring ($bbb$) by changing all $a$s to $b$s. Since this renaming does not affect the equality of any pairs of nodes these colorings have to be equivalent. We do not need to search both of these colorings, if one coloring is valid so is the other one, and vice versa. This holds true for all colorings, consider $abc$ and it's 5 equivalent colorings: $acb$, $bac$, $bca$, $cab$, $cba$. Note that the number of equivalent colorings is the number of permutations of the number of colors, or $r!$.

We define an ordering for all colors, in this paper alphabetical order will be used. So $a < b < c$ when ordering colors. Each coloring can then be ordered using lexicographic ordering. For all colorings with 3 distinct colors we get $abc < acb < bac < bca < cab < cba$. We then pick the ''smallest'' coloring, the first coloring when all equivalent colorings are lexicographically sorted, this is referred to as the representative. Each coloring can be mapped to an equivalent representative coloring.

\section{Categories of Colorings}
We can also group colorings into categories. This can be done by mapping the coloring to it's representative, the coloring which is equivalent and lexicographically sorted first. Then we replace all but the first appearance of color with the 0-color (in our case $a$), we now have the representative category of the coloring. An example will make this clearer.

Consider the coloring $cbbaabbc$, we can easily find the representative equivalent coloring by the renaming: $c \rightarrow a, b \rightarrow a, a \rightarrow c$. This gives us $abbccbba$ (which indeed comes before $cbbaabbc$ lexicographically). We then replace all the colors after the first appearance of each color with $a$ and we get $abacaaaa$, which is our category representative.

The category representatives correspond to the nodes where searching starts in the no-rainbow algorithm.

We further note that each coloring can be mapped to exactly one category. If we search all categories we have searched all equivalent nodes and the categories perfectly partition the space of all colorings.

There are two surjective categories which are very simple to reason about, the smallest category and the largest category. The smallest category has the longest prefix of 0-colors, e.g. $aaabc$ -- 6 node in total and 1 equivalent representative. The largest category has the longest suffix of 0-color, e.g. $abcaa$ -- 54 nodes and 9 equivalent representatives in total. The smallest category always has exactly one node. Also note that a tail of 0-colors is completely unconstrained and a prefix of 0-colors is forced to stay, if we are to only visit the equivalent representatives.

A complete listing of all categories and the equivalent representative colorings which are a part of them for $n=5, r=3$ is shown in Figure \ref{fig:cats}. For the surjective colorings there are always $r!$ equivalent colorings. This is now true for the non-surjective colorings. The Figure \ref{fig:cats} shows the 6 surjective categories and the 6 non-surjective categories. We can see largest surjective category $abcaa$ and the smallest surjective category $aaabc$.


\begin{center}
  \begin{figure}
\centering
\vspace{1em}

\begin{forest}
  [\underline{ aaabc },circle,draw
  ]
\end{forest}

\begin{forest}
  [\underline{ aabac },circle,draw
    [aabbc]
  ]
\end{forest}
\begin{forest}
  [\underline{ aabca },circle,draw
    [aabcc]
    [aabcb]
  ]
\end{forest}
\begin{forest}
  [\underline{ abaac },circle,draw
    [ababc]
    [abbac]
    [abbbc]
  ]
\end{forest}
\begin{forest}
  [\underline{ abaca },circle,draw
    [abbcc]
    [abacc]
    [abacb]
    [abbca]
    [abbcb]
  ]
\end{forest}

\begin{forest}
  [\underline{ abcaa },circle,draw
    [abcac]
    [abcab]
    [abccc]
    [abcca]
    [abccb]
    [abcbc]
    [abcba]
    [abcbb]
  ]
\end{forest}

\begin{forest}
  [aaaaa,circle,draw
  ]
\end{forest}
\begin{forest}
  [aaaab,circle,draw
  ]
\end{forest}

\begin{forest}
  [aaaba,circle,draw
    [aaabb]
  ]
\end{forest}
\begin{forest}
  [aabaa,circle,draw
    [aabbb]
    [aabab]
    [aabba]
  ]
\end{forest}
\begin{forest}
  [abaaa,circle,draw
    [abaab]
    [abbaa]
    [abbab]
    [abbbb]
    [ababa]
    [ababb]
    [abbba]
  ]
\end{forest}

\vspace{1em}

\caption{A visualization of all the equivalent representatives in each category for $n=5, r=3$. A category representative is marked with a circle, if the category has all colors in it an underline is added. Only the equivalence representatives are shown to make the figure easier to parse.}
\label{fig:cats}
\end{figure}
\end{center}

\chapter{The Improved Algorithm for the No-Rainbow problem}

\begin{verbatim}
DetNRC(H):
  foreach top_coloring(c, F) do
    if DetLocalSearch(H, c, F) then
      return YES
  return NO

DetLocalSearch(H, c, F):
  -- This is the secret sauce
  if g = 0 and induces_raindbow_edge(c, H) then return NO
  if induces_raindbow_edge(c, H).issubset(F) then return NO
  if is_no_rainbow_coloring(c, H) then return YES
  if |e intersect F| != r - 1 forall e in E then return YES
  e' = pick_any(e where |e intersect F| == r - 1)
  v = pick_any(v in (e' - F))
  foreach j in [r] - {c(v)} do
    c' := c but c(v) = j
    if not isSameCategory(c', c) then continue
    if not isRepresentativeColoring(c') then continue
    if DetLocalSearch(H, c', F union {v}) then return YES

  return NO
\end{verbatim}

\end{document}
